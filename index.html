<!DOCTYPE html>
<html>
<head>
    <title>åŸºé‡‘æ¯”ä¾‹è®¡ç®—å™¨ï¼ˆæ”¯æŒä¿å­˜ï¼‰</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: auto; }
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        .fund-item { display: flex; gap: 10px; margin-bottom: 10px; }
        .fund-item input { padding: 8px; flex: 1; }
        button { background: #4CAF50; color: white; padding: 10px; border: none; cursor: pointer; }
        #addFund { background: #2196F3; margin-bottom: 15px; }
        #clearBtn { background: #f44336; margin-left: 10px; }
        table { width: 100%; margin-top: 20px; border-collapse: collapse; }
        td, th { border: 1px solid #ddd; padding: 8px; text-align: left; }
    </style>
</head>
<body>
    <div class="container">
        <h3>åŸºé‡‘æ¯”ä¾‹è®¡ç®—å™¨ï¼ˆæ”¯æŒä¿å­˜ï¼‰</h3>
        
        <!-- åŠ¨æ€æ·»åŠ åŸºé‡‘åŒºåŸŸ -->
        <div id="fundsContainer"></div>

        <button id="addFund" onclick="addFund()">ï¼‹ æ·»åŠ åŸºé‡‘</button>
        <button id="clearBtn" onclick="clearData()">ğŸ—‘ï¸ æ¸…é™¤æ•°æ®</button>

        <div class="input-group">
            <label>ä½ çš„æ€»é‡‘é¢ï¼ˆå…ƒï¼‰:</label>
            <input type="number" id="userTotal" step="0.01">
        </div>

        <button onclick="calculate()">ç«‹å³è®¡ç®—</button>

        <div id="result"></div>
    </div>

    <script>
        const STORAGE_KEY = "fundCalculatorData";

        // åŠ è½½æ•°æ®
        function loadData() {
            const savedData = localStorage.getItem(STORAGE_KEY);
            if (savedData) {
                const { funds, userTotal } = JSON.parse(savedData);
                fundsContainer.innerHTML = '';
                funds.forEach(fund => addFund(fund.name, fund.amount));
                document.getElementById("userTotal").value = userTotal || "1735.87";
            } else {
                addFund(); // é»˜è®¤æ·»åŠ ä¸€è¡Œ
            }
        }

        // ä¿å­˜æ•°æ®
        function saveData() {
            const funds = [];
            document.querySelectorAll(".fund-item").forEach(item => {
                const name = item.querySelector(".fund-name").value.trim();
                const amount = parseFloat(item.querySelector(".fund-amount").value);
                if (name && !isNaN(amount)) funds.push({ name, amount });
            });

            localStorage.setItem(STORAGE_KEY, JSON.stringify({
                funds,
                userTotal: document.getElementById("userTotal").value
            }));
        }

        // æ·»åŠ åŸºé‡‘è¡Œ
        function addFund(name = '', amount = '') {
            const div = document.createElement("div");
            div.className = "fund-item";
            div.innerHTML = `
                <input type="text" placeholder="åŸºé‡‘åç§°" class="fund-name" value="${name}" oninput="saveData()">
                <input type="number" placeholder="é‡‘é¢ï¼ˆå…ƒï¼‰" class="fund-amount" step="0.01" value="${amount}" oninput="saveData()">
            `;
            fundsContainer.appendChild(div);
        }

        // æ¸…é™¤æ•°æ®
        function clearData() {
            localStorage.removeItem(STORAGE_KEY);
            fundsContainer.innerHTML = '';
            document.getElementById("userTotal").value = "1735.87";
            addFund(); // æ·»åŠ åˆå§‹ç©ºè¡Œ
            document.getElementById("result").innerHTML = ''; // æ¸…ç©ºç»“æœ
        }

        // è®¡ç®—åŠŸèƒ½
        function calculate() {
            const funds = [];
            let bloggerTotal = 0;

            document.querySelectorAll(".fund-item").forEach(item => {
                const name = item.querySelector(".fund-name").value.trim();
                const amount = parseFloat(item.querySelector(".fund-amount").value);
                if (name && !isNaN(amount)) {
                    funds.push({ name, amount });
                    bloggerTotal += amount;
                }
            });

            if (funds.length === 0 || bloggerTotal <= 0) {
                alert("è¯·è‡³å°‘è¾“å…¥ä¸€ä¸ªæœ‰æ•ˆçš„åŸºé‡‘åç§°å’Œé‡‘é¢");
                return;
            }

            const userTotal = parseFloat(document.getElementById("userTotal").value);
            if (isNaN(userTotal)) {
                alert("è¯·è¾“å…¥æœ‰æ•ˆçš„æ€»é‡‘é¢");
                return;
            }

            let html = `
                <table>
                    <tr>
                        <th>åŸºé‡‘åç§°</th>
                        <th>åšä¸»é‡‘é¢ï¼ˆå…ƒï¼‰</th>
                        <th>æŠ•èµ„æ¯”ä¾‹</th>
                        <th>ä½ çš„é‡‘é¢ï¼ˆå…ƒï¼‰</th>
                    </tr>`;

            let totalCheck = 0;
            funds.forEach(fund => {
                const ratio = (fund.amount / bloggerTotal * 100).toFixed(2) + "%";
                const userAmount = (userTotal * fund.amount / bloggerTotal).toFixed(2);
                totalCheck += parseFloat(userAmount);

                html += `
                    <tr>
                        <td>${fund.name}</td>
                        <td>${fund.amount.toFixed(2)}</td>
                        <td>${ratio}</td>
                        <td>${userAmount}</td>
                    </tr>`;
            });

            html += `
                <tr style="background: #f0f0f0">
                    <td colspan="3">æ€»è®¡</td>
                    <td>${totalCheck.toFixed(2)}</td>
                </tr>
            </table>`;

            document.getElementById("result").innerHTML = html;
        }

        // åˆå§‹åŒ–
        window.onload = loadData;
    </script>
</body>
</html>
